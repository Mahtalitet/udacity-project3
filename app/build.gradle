apply plugin: 'com.android.application'

apply from: rootProject.file('tools/lint.gradle')
apply from: rootProject.file('tools/ci-functions.gradle')

configurations.all {
  resolutionStrategy {
    force rootProject.ext.javaPoet
    force rootProject.ext.guava
  }
}

android {
  compileSdkVersion rootProject.ext.targetSdkVersion
  buildToolsVersion rootProject.ext.buildToolsVersion

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }

  dexOptions {
    maxProcessCount 2
    javaMaxHeapSize "2g"
  }

  defaultConfig {
    applicationId "ru.rinekri.udacitypopularmovies"
    minSdkVersion rootProject.ext.minSdkVersion
    targetSdkVersion rootProject.ext.targetSdkVersion
    versionCode 1
    versionName "2.0"
    signingConfig signingConfigs.debug
    multiDexEnabled true

    buildConfigField 'String', 'API_BASE_URL', '"https://api.themoviedb.org"'
    buildConfigField 'String', 'IMAGE_STORE_BASE_URL', '"http://image.tmdb.org"'
    buildConfigField 'String', 'DB_MOVIE_API_KEY', '"' + getApiKey() + '"'
  }

  signingConfigs {
    debug {
      storeFile file("$rootProject.rootDir/keystore/debug.keystore")
    }
  }

  buildTypes {
    debug {
      versionNameSuffix '.debug'
      minifyEnabled false
      resValue 'string', 'app_name', "$rootProject.ext.appName (debug)"
    }
    release {
      minifyEnabled false
      resValue 'string', 'app_name', "$rootProject.ext.appName"
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  dataBinding {
    enabled = true
  }
}

dependencies {
  implementation fileTree(dir: 'libs', include: ['*.jar'])
  implementation rootProject.ext.coreDepends
  implementation rootProject.ext.supportLibDepends
  implementation rootProject.ext.otherDepends
  implementation rootProject.ext.streamsBackportDepends
  implementation rootProject.ext.multidex
  implementation rootProject.ext.guava

  debugImplementation rootProject.ext.leakCanary
  releaseImplementation rootProject.ext.leakCanaryNoOp

  compileOnly rootProject.ext.providedDepends
  compileOnly rootProject.ext.compileOnlyDepends

  annotationProcessor rootProject.ext.javaPoet
  annotationProcessor rootProject.ext.aptDepends

  testCompile 'junit:junit:4.12'
}